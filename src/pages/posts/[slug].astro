---
import { postCategories } from "@/resources/static/links";
import Card from "@/components/segments/Card";
import PageDescription from "@/components/segments/PageDescription.astro";
import { SITE } from "@/config.mjs";
import PageLayout from "@/layouts/PageLayout.astro";
import { getNumberOfPosts, getSortedPosts } from "@/util/posts-utils";

export function getStaticPaths() {
  return postCategories.map((category) => {
    return {
      params: { slug: category.slug },
      props: {
        categoryName: category.name,
        categoryDescription: category.description,
      },
    };
  });
}

const { categoryName, categoryDescription } = Astro.props;
const { slug } = Astro.params;

const numberOfPages: number = Math.ceil(
  (await getNumberOfPosts(slug)) / SITE.postsPerPage
);

const posts = await getSortedPosts(slug);
---

<PageLayout>
  <PageDescription
    pages={numberOfPages}
    description={categoryDescription}
    categoriesPath={["posts", slug!]}
    pageName={categoryName}
  />

  <ul class="grid text-skin-base grid-cols-1 lg:grid-cols-2 mt-5 max-w-3xl mx-auto">
    {posts.map((post) => <div class="max-w-sm my-2.5 lg:mx-2.5 place-self-center"><Card post={post} showCategory={false} /></div>)}
  </ul>
</PageLayout>
